{% extends "generic.html" %}
{% block contents %}
    <div class="row justify-content-md-center">
        <div class="col-sm-8">
            {% if var %}
                <h1>Virus Spread Simulation</h1>
                <div class="row">
                    <div class="col-sm-9">
                        <p class="lead">Choose parameters</p>
                        <!--<form action="https://ehno8ok3r3.execute-api.eu-west-1.amazonaws.com/allocate_simulation" method="post" id="parametersForm">-->
                        <form id="parametersForm">
                            <div class="form-group">
                                <label for="individuals">Amount of people</label>
                                <input type="number" name="individuals" class="form-control" id="individuals" aria-describedby="indivHelp" min="0" placeholder="1000">
                                <small id="indivHelp" class="form-text text-muted pb-3">Recommended up to 10000 people</small>
                            </div>
                            <div class="form-group">
                                <label for="incubation">Incubation Time</label>
                                <input type="number" name="incubation" class="form-control" id="incubation" aria-describedby="incubHelp" min="0" placeholder="1">
                                <small id="incubHelp" class="form-text text-muted pb-3">Unlimited</small>
                            </div>
                            <div class="form-group">
                                <label for="symptom">Symptomatic Seed</label>
                                <input type="number" name="symptomatic" class="form-control" id="symptom" aria-describedby="symptomHelp" placeholder="10" min="0" max="90">
                                <small id="symptomHelp" class="form-text text-muted pb-3">0-90</small>
                            </div>
                            <div class="form-group">
                                <label for="symptom">Immunity Rate</label>
                                <input type="number" name="immunity" class="form-control" id="immun" aria-describedby="immunHelp" placeholder="10" min="0" max="90">
                                <small id="immunHelp" class="form-text text-muted pb-3">0-90</small>
                            </div>
                            <div class="form-group">
                                <label for="mortalityRate">Mortality Rate</label>
                                <input type="number" name="mortality" class="form-control" id="mortalityRate" aria-describedby="mortHelp" placeholder="10" min="0" max="100">
                                <small id="mortHelp" class="form-text text-muted pb-3">0-100</small>
                            </div>
                            <div class="form-group">
                                <label for="previewAccess">Interested in Preview Access?</label>
                                <select class="form-control" name="previewAccess" id="previewAccess">
                                    <option>Yes</option>
                                    <option>No</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="scaleCity">Scale City</label>
                                <input type="number" name="scale_city" class="form-control" id="scaleCity" aria-describedby="scaleHelp" placeholder="10" min="0">
                                <small id="scaleHelp" class="form-text text-muted pb-3">>0</small>
                            </div>
                            <div class="form-group">
                                <label for="maxRounds">Maximum Amount of Numbers</label>
                                <input type="number" name="max_rounds" class="form-control" id="maxRounds" aria-describedby="roundsHelp" placeholder="10" min="0">
                                <small id="roundsHelp" class="form-text text-muted pb-3">>0</small>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" name="beacons" class="form-check-input" id="beacons" aria-describedby="beaconsHelp">
                                <label class="form-check-label" for="beacons">Beacons</label>
                                <small id="beaconsHelp" class="form-text text-muted pb-3">Use beacons?</small>
                            </div>
                            <!--<p><a type="submit" id="test" class="btn btn-success" href="{% url 'form:simulation' %}">Start!</a></p>-->
                        </form>
                        <!--
                        <form id="test-form">
                           <label for="maxRounds">Maximum Amount of Numbers</label>
                            <input type="number" name="max_rounds" class="form-control" id="test-label" aria-describedby="roundsHelp" placeholder="10" min="0">
                        </form>
                        -->

                        <button type="button" type = "submit"  id="test-button2">Allocate city.</button>
                        <button type="button" type = "submit"  id="test-button3" disabled>Start simulation.</button>
                        <!--<button type="button" type = "submit"  id="test-button4">Stop simulation.</button>-->
                    </div>
                </div></div>
            {% else %}
                <div class="jumbotron" id="simstart">
                    <h1>Virus Spread Simulation</h1>
                    <div class="row">
                        <div class="col-sm-9">
                            <p>Another simulation has already been started :(</p>
                            <p><a class="btn btn-success" href="{% url 'form:simulation' %}">Go to the simulation</a></p>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}

{% block scripts %}

    <script>
    /*
    $(document).ready(function{
        $("#test").click(function){
            $.post("https://ehno8ok3r3.execute-api.eu-west-1.amazonaws.com/allocate_simulation"),
                {
                    {"individuals": 2000,"incubation": 2,"symptomatic": 4,"immunity": 14,"mortality": 10, "beacons": "True","scale_city": 200,"max_rounds": 1}

                }
        }
    })
    */
    </script>
    <script>
    /*
    $("#simParameters").submit(function(event){
	event.preventDefault(); //prevent default action
	var post_url = $(this).attr("action"); //get form action url
	var form_data = $(this).serialize(); //Encode form elements for submission

	$.post( post_url, form_data, function( response ) {});
    });
    */
    </script>
    <script>

    /*
    $("#test-button").click(function(){
                var dict = {individuals: 2000, incubation: 2, symptomatic: 4, immunity: 14, mortality: 10, beacons: "True",
            scale_city: 200, max_rounds: 1};
        var res = JSON.stringify(dict);
        console.log(res)
        $.post("https://ehno8ok3r3.execute-api.eu-west-1.amazonaws.com/allocate_simulation", res, function( response )
        {console.log(response)}).fail(function(err){console.log(err);});

    });
    */

    $("#test-button4").click(function(){
            var aux_data = {"command": "stop", "id":"arn:aws:ecs:eu-west-1:359072603960:task/default/f8c3148bf62a4dbda9718eefa0d2513f"}

            jQuery.ajax ({
                url: "https://860ty33200.execute-api.eu-west-1.amazonaws.com/ccbda/job-issuer",
                type: "POST",
                data: JSON.stringify(aux_data),
                dataType: "json",
                contentType: "application/json"
	        }).done(function(data){
	            console.log(data)
	        }).fail(function(xhr, error){
	            console.log(error);
	        })
    });


    $("#test-button3").click(function(){
            var aux_data = {"command": "run"}

            jQuery.ajax ({
                url: "https://860ty33200.execute-api.eu-west-1.amazonaws.com/ccbda/job-issuer",
                type: "POST",
                data: JSON.stringify(aux_data),
                dataType: "json",
                contentType: "application/json"
	        }).done(function(data){
	            console.log(data)

                window.location.href="{% url 'form:simulation' %}";

	        }).fail(function(xhr, error){
	            console.log(error);
	        })
    });


    $("#test-button2").click(function(){
            var aux_data = {"individuals": 1000,"incubation": 1,"symptomatic": 4,"immunity": 14,"mortality": 10, "beacons": "False","scale_city": 200,"max_rounds": 50}

            jQuery.ajax ({
                url: "https://860ty33200.execute-api.eu-west-1.amazonaws.com/ccbda/allocate-city",
                type: "POST",
                data: JSON.stringify(aux_data),
                dataType: "json",
                contentType: "application/json"
	        }).done(function(data){
	            console.log(data)

                $("#test-button3").removeAttr("disabled");
	            $(this).attr('disabled', true);

	        }).fail(function(xhr, error){
	            console.log(error);
	        })
    });



    </script>
{% endblock %}
