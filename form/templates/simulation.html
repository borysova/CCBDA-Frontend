{% extends "generic.html" %}
{% block contents %}
    <div class="row justify-content-md-center">
        <div class="col-sm-12">
            <div class="jumbotron" id="jumboparameters">
                <p class="lead">Parameters of current simulation</p>
            </div>
            <div class="jumbotron" id="jumbograph">
                <div class="row">
                    <div class="col-sm-12">

                        <figure class="highcharts-figure">

                            <div id="container"></div>

	                    </figure>
<<<<<<< HEAD
                        <button type="button" type = "submit"  id="test-button">Refresh graphics.</button>
=======
                        <p class="pt-3 d-flex justify-content-center"><a class="btn btn-success" href="{% url 'form:home' %}">Back to the homepage</a></p>
                        <div align="center"><button id="stop" type="submit" class="pt-1 btn btn-success">Stop simulation</button></div>
>>>>>>> c1313fbb138c9fbb47e1d5a0bdc2eee52cc3bb0f
                        <!--<button type="button" type = "submit"  id="test-button2">Stop simulation.</button>-->
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}

    <script>


        $(function() {
            function refresh(){
                $.get("https://860ty33200.execute-api.eu-west-1.amazonaws.com/ccbda/stats?id=1", function(data, status){
                console.log(data);

	            round= data.round;

                infected.push([round,data.stats.infected]);
	            immune.push([round,data.stats.immune]);
	            dead.push([round,data.stats.dead]);

	            print_chart(round);


            });
            }
            var refreshIntervalId = setInterval(refresh, 10000);
        });



        /*


        $("#test-button").click(function(){

            $.get("https://860ty33200.execute-api.eu-west-1.amazonaws.com/ccbda/stats?id=1", function(data, status){
                console.log(data);

	            round= data.round;

                infected.push([round,data.stats.infected]);
	            immune.push([round,data.stats.immune]);
	            dead.push([round,data.stats.dead]);

	            print_chart(round);


            });
        }); */


        $("#stop").click(function(){
            var aux_data = {"command": "stop", "id":"arn:aws:ecs:eu-west-1:359072603960:task/default/f8c3148bf62a4dbda9718eefa0d2513f"}

            jQuery.ajax ({
                url: "https://860ty33200.execute-api.eu-west-1.amazonaws.com/ccbda/job-issuer",
                type: "POST",
                data: JSON.stringify(aux_data),
                dataType: "json",
                contentType: "application/json"
	        }).done(function(data){
	            console.log(data);
	        }).fail(function(xhr, error){
	            console.log(error);
	        })
        });



        var infected = [[0,0]];
        var immune = [[0,0]];
        var dead = [[0,0]];


        function print_chart(number_of_rounds) {

            Highcharts.chart('container', {

                title: {
                    text: 'Simulation statistics by round'
                },


                yAxis: {
                    title: {
                        text: 'People'
                    }
                },

                xAxis: {
                    accessibility: {
                        rangeDescription: 'Range: 0 to '+ number_of_rounds.toString()
                    },
                    title: {
                        text: 'Round'
                    }
                },

                legend: {
                    layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'middle'
                },

                plotOptions: {
                    series: {
                        label: {
                            connectorAllowed: false
                        },
                        pointStart: 0
                    }
                },

                series: [{
                    name: 'Infected',
                    data: infected
                }, {
                    name: 'Immune',
                    data: immune
                }, {
                    name: 'Dead',
                    data: dead
                }],

                responsive: {
                    rules: [{
                        condition: {
                            maxWidth: 500
                        },
                        chartOptions: {
                            legend: {
                                layout: 'horizontal',
                                align: 'center',
                                verticalAlign: 'bottom'
                            }
                        }
                    }]
                }

            });

        }

        print_chart(0);



    </script>

{% endblock %}